"use strict";

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj; };

/*
 * textillate.js
 * http://jschr.github.com/textillate
 * MIT licensed
 *
 * Copyright (C) 2012-2013 Jordan Schroter
 */

(function ($) {
  "use strict";

  function isInEffect(effect) {
    return (/In/.test(effect) || $.inArray(effect, $.fn.textillate.defaults.inEffects) >= 0
    );
  };

  function isOutEffect(effect) {
    return (/Out/.test(effect) || $.inArray(effect, $.fn.textillate.defaults.outEffects) >= 0
    );
  };

  function stringToBoolean(str) {
    if (str !== "true" && str !== "false") return str;
    return str === "true";
  };

  // custom get data api method
  function getData(node) {
    var attrs = node.attributes || [],
        data = {};

    if (!attrs.length) return data;

    $.each(attrs, function (i, attr) {
      var nodeName = attr.nodeName.replace(/delayscale/, 'delayScale');
      if (/^data-in-*/.test(nodeName)) {
        data.in = data.in || {};
        data.in[nodeName.replace(/data-in-/, '')] = stringToBoolean(attr.nodeValue);
      } else if (/^data-out-*/.test(nodeName)) {
        data.out = data.out || {};
        data.out[nodeName.replace(/data-out-/, '')] = stringToBoolean(attr.nodeValue);
      } else if (/^data-*/.test(nodeName)) {
        data[nodeName.replace(/data-/, '')] = stringToBoolean(attr.nodeValue);
      }
    });

    return data;
  }

  function shuffle(o) {
    for (var j, x, i = o.length; i; j = parseInt(Math.random() * i), x = o[--i], o[i] = o[j], o[j] = x) {}
    return o;
  }

  function animate($t, effect, cb) {
    $t.addClass('animated ' + effect).css('visibility', 'visible').show();

    $t.one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend', function () {
      $t.removeClass('animated ' + effect);
      cb && cb();
    });
  }

  function animateTokens($tokens, options, cb) {
    var that = this,
        count = $tokens.length;

    if (!count) {
      cb && cb();
      return;
    }

    if (options.shuffle) $tokens = shuffle($tokens);
    if (options.reverse) $tokens = $tokens.toArray().reverse();

    $.each($tokens, function (i, t) {
      var $token = $(t);

      function complete() {
        if (isInEffect(options.effect)) {
          $token.css('visibility', 'visible');
        } else if (isOutEffect(options.effect)) {
          $token.css('visibility', 'hidden');
        }
        count -= 1;
        if (!count && cb) cb();
      }

      var delay = options.sync ? options.delay : options.delay * i * options.delayScale;

      $token.text() ? setTimeout(function () {
        animate($token, options.effect, complete);
      }, delay) : complete();
    });
  };

  var Textillate = function Textillate(element, options) {
    var base = this,
        $element = $(element);

    base.init = function () {
      base.$texts = $element.find(options.selector);

      if (!base.$texts.length) {
        base.$texts = $('<ul class="texts"><li>' + $element.html() + '</li></ul>');
        $element.html(base.$texts);
      }

      base.$texts.hide();

      base.$current = $('<span>').html(base.$texts.find(':first-child').html()).prependTo($element);

      if (isInEffect(options.in.effect)) {
        base.$current.css('visibility', 'hidden');
      } else if (isOutEffect(options.out.effect)) {
        base.$current.css('visibility', 'visible');
      }

      base.setOptions(options);

      base.timeoutRun = null;

      setTimeout(function () {
        base.options.autoStart && base.start();
      }, base.options.initialDelay);
    };

    base.setOptions = function (options) {
      base.options = options;
    };

    base.triggerEvent = function (name) {
      var e = $.Event(name + '.tlt');
      $element.trigger(e, base);
      return e;
    };

    base.in = function (index, cb) {
      index = index || 0;

      var $elem = base.$texts.find(':nth-child(' + ((index || 0) + 1) + ')'),
          options = $.extend(true, {}, base.options, $elem.length ? getData($elem[0]) : {}),
          $tokens;

      $elem.addClass('current');

      base.triggerEvent('inAnimationBegin');

      base.$current.html($elem.html()).lettering('words');

      // split words to individual characters if token type is set to 'char'
      if (base.options.type == "char") {
        base.$current.find('[class^="word"]').css({
          'display': 'inline-block',
          // fix for poor ios performance
          '-webkit-transform': 'translate3d(0,0,0)',
          '-moz-transform': 'translate3d(0,0,0)',
          '-o-transform': 'translate3d(0,0,0)',
          'transform': 'translate3d(0,0,0)'
        }).each(function () {
          $(this).lettering();
        });
      }

      $tokens = base.$current.find('[class^="' + base.options.type + '"]').css('display', 'inline-block');

      if (isInEffect(options.in.effect)) {
        $tokens.css('visibility', 'hidden');
      } else if (isOutEffect(options.in.effect)) {
        $tokens.css('visibility', 'visible');
      }

      base.currentIndex = index;

      animateTokens($tokens, options.in, function () {
        base.triggerEvent('inAnimationEnd');
        if (options.in.callback) options.in.callback();
        if (cb) cb(base);
      });
    };

    base.out = function (cb) {
      var $elem = base.$texts.find(':nth-child(' + ((base.currentIndex || 0) + 1) + ')'),
          $tokens = base.$current.find('[class^="' + base.options.type + '"]'),
          options = $.extend(true, {}, base.options, $elem.length ? getData($elem[0]) : {});

      base.triggerEvent('outAnimationBegin');

      animateTokens($tokens, options.out, function () {
        $elem.removeClass('current');
        base.triggerEvent('outAnimationEnd');
        if (options.out.callback) options.out.callback();
        if (cb) cb(base);
      });
    };

    base.start = function (index) {
      setTimeout(function () {
        base.triggerEvent('start');

        (function run(index) {
          base.in(index, function () {
            var length = base.$texts.children().length;

            index += 1;

            if (!base.options.loop && index >= length) {
              if (base.options.callback) base.options.callback();
              base.triggerEvent('end');
            } else {
              index = index % length;

              base.timeoutRun = setTimeout(function () {
                base.out(function () {
                  run(index);
                });
              }, base.options.minDisplayTime);
            }
          });
        })(index || 0);
      }, base.options.initialDelay);
    };

    base.stop = function () {
      if (base.timeoutRun) {
        clearInterval(base.timeoutRun);
        base.timeoutRun = null;
      }
    };

    base.init();
  };

  $.fn.textillate = function (settings, args) {
    return this.each(function () {
      var $this = $(this),
          data = $this.data('textillate'),
          options = $.extend(true, {}, $.fn.textillate.defaults, getData(this), (typeof settings === "undefined" ? "undefined" : _typeof(settings)) == 'object' && settings);

      if (!data) {
        $this.data('textillate', data = new Textillate(this, options));
      } else if (typeof settings == 'string') {
        data[settings].apply(data, [].concat(args));
      } else {
        data.setOptions.call(data, options);
      }
    });
  };

  $.fn.textillate.defaults = {
    selector: '.texts',
    loop: false,
    minDisplayTime: 2000,
    initialDelay: 0,
    in: {
      effect: 'fadeInLeftBig',
      delayScale: 1.5,
      delay: 50,
      sync: false,
      reverse: false,
      shuffle: false,
      callback: function callback() {}
    },
    out: {
      effect: 'hinge',
      delayScale: 1.5,
      delay: 50,
      sync: false,
      reverse: false,
      shuffle: false,
      callback: function callback() {}
    },
    autoStart: true,
    inEffects: [],
    outEffects: ['hinge'],
    callback: function callback() {},
    type: 'char'
  };
})(jQuery);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2xpYi90ZXh0aWxsYXRlLmpzIl0sIm5hbWVzIjpbIiQiLCJpc0luRWZmZWN0IiwiZWZmZWN0IiwidGVzdCIsImluQXJyYXkiLCJmbiIsInRleHRpbGxhdGUiLCJkZWZhdWx0cyIsImluRWZmZWN0cyIsImlzT3V0RWZmZWN0Iiwib3V0RWZmZWN0cyIsInN0cmluZ1RvQm9vbGVhbiIsInN0ciIsImdldERhdGEiLCJub2RlIiwiYXR0cnMiLCJhdHRyaWJ1dGVzIiwiZGF0YSIsImxlbmd0aCIsImVhY2giLCJpIiwiYXR0ciIsIm5vZGVOYW1lIiwicmVwbGFjZSIsImluIiwibm9kZVZhbHVlIiwib3V0Iiwic2h1ZmZsZSIsIm8iLCJqIiwieCIsInBhcnNlSW50IiwiTWF0aCIsInJhbmRvbSIsImFuaW1hdGUiLCIkdCIsImNiIiwiYWRkQ2xhc3MiLCJjc3MiLCJzaG93Iiwib25lIiwicmVtb3ZlQ2xhc3MiLCJhbmltYXRlVG9rZW5zIiwiJHRva2VucyIsIm9wdGlvbnMiLCJ0aGF0IiwiY291bnQiLCJyZXZlcnNlIiwidG9BcnJheSIsInQiLCIkdG9rZW4iLCJjb21wbGV0ZSIsImRlbGF5Iiwic3luYyIsImRlbGF5U2NhbGUiLCJ0ZXh0Iiwic2V0VGltZW91dCIsIlRleHRpbGxhdGUiLCJlbGVtZW50IiwiYmFzZSIsIiRlbGVtZW50IiwiaW5pdCIsIiR0ZXh0cyIsImZpbmQiLCJzZWxlY3RvciIsImh0bWwiLCJoaWRlIiwiJGN1cnJlbnQiLCJwcmVwZW5kVG8iLCJzZXRPcHRpb25zIiwidGltZW91dFJ1biIsImF1dG9TdGFydCIsInN0YXJ0IiwiaW5pdGlhbERlbGF5IiwidHJpZ2dlckV2ZW50IiwibmFtZSIsImUiLCJFdmVudCIsInRyaWdnZXIiLCJpbmRleCIsIiRlbGVtIiwiZXh0ZW5kIiwibGV0dGVyaW5nIiwidHlwZSIsImN1cnJlbnRJbmRleCIsImNhbGxiYWNrIiwicnVuIiwiY2hpbGRyZW4iLCJsb29wIiwibWluRGlzcGxheVRpbWUiLCJzdG9wIiwiY2xlYXJJbnRlcnZhbCIsInNldHRpbmdzIiwiYXJncyIsIiR0aGlzIiwiYXBwbHkiLCJjb25jYXQiLCJjYWxsIiwialF1ZXJ5Il0sIm1hcHBpbmdzIjoiOzs7O0FBQ0E7Ozs7Ozs7O0FBUUMsV0FBVUEsQ0FBVixFQUFhO0FBQ1o7O0FBRUEsV0FBU0MsVUFBVCxDQUFxQkMsTUFBckIsRUFBNkI7QUFDM0IsV0FBTyxNQUFLQyxJQUFMLENBQVVELE1BQVYsS0FBcUJGLEVBQUVJLE9BQUYsQ0FBVUYsTUFBVixFQUFrQkYsRUFBRUssRUFBRixDQUFLQyxVQUFMLENBQWdCQyxRQUFoQixDQUF5QkMsU0FBM0MsS0FBeUQ7QUFBckY7QUFDRDs7QUFFRCxXQUFTQyxXQUFULENBQXNCUCxNQUF0QixFQUE4QjtBQUM1QixXQUFPLE9BQU1DLElBQU4sQ0FBV0QsTUFBWCxLQUFzQkYsRUFBRUksT0FBRixDQUFVRixNQUFWLEVBQWtCRixFQUFFSyxFQUFGLENBQUtDLFVBQUwsQ0FBZ0JDLFFBQWhCLENBQXlCRyxVQUEzQyxLQUEwRDtBQUF2RjtBQUNEOztBQUdELFdBQVNDLGVBQVQsQ0FBeUJDLEdBQXpCLEVBQThCO0FBQzVCLFFBQUlBLFFBQVEsTUFBUixJQUFrQkEsUUFBUSxPQUE5QixFQUF1QyxPQUFPQSxHQUFQO0FBQ3ZDLFdBQVFBLFFBQVEsTUFBaEI7QUFDRDs7QUFFRDtBQUNBLFdBQVNDLE9BQVQsQ0FBa0JDLElBQWxCLEVBQXdCO0FBQ3RCLFFBQUlDLFFBQVFELEtBQUtFLFVBQUwsSUFBbUIsRUFBL0I7QUFBQSxRQUNJQyxPQUFPLEVBRFg7O0FBR0EsUUFBSSxDQUFDRixNQUFNRyxNQUFYLEVBQW1CLE9BQU9ELElBQVA7O0FBRW5CakIsTUFBRW1CLElBQUYsQ0FBT0osS0FBUCxFQUFjLFVBQVVLLENBQVYsRUFBYUMsSUFBYixFQUFtQjtBQUMvQixVQUFJQyxXQUFXRCxLQUFLQyxRQUFMLENBQWNDLE9BQWQsQ0FBc0IsWUFBdEIsRUFBb0MsWUFBcEMsQ0FBZjtBQUNBLFVBQUksYUFBYXBCLElBQWIsQ0FB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ZUFBVyxFQXhCYztBQXlCekJFLGdCQUFZLENBQUUsT0FBRixDQXpCYTtBQTBCekIyRSxjQUFVLG9CQUFZLENBQUUsQ0ExQkM7QUEyQnpCRixVQUFNO0FBM0JtQixHQUEzQjtBQThCRCxDQXRSQSxFQXNSQ2UsTUF0UkQsQ0FBRCIsImZpbGUiOiJ0ZXh0aWxsYXRlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXG4vKlxuICogdGV4dGlsbGF0ZS5qc1xuICogaHR0cDovL2pzY2hyLmdpdGh1Yi5jb20vdGV4dGlsbGF0ZVxuICogTUlUIGxpY2Vuc2VkXG4gKlxuICogQ29weXJpZ2h0IChDKSAyMDEyLTIwMTMgSm9yZGFuIFNjaHJvdGVyXG4gKi9cblxuKGZ1bmN0aW9uICgkKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIGZ1bmN0aW9uIGlzSW5FZmZlY3QgKGVmZmVjdCkge1xuICAgIHJldHVybiAvSW4vLnRlc3QoZWZmZWN0KSB8fCAkLmluQXJyYXkoZWZmZWN0LCAkLmZuLnRleHRpbGxhdGUuZGVmYXVsdHMuaW5FZmZlY3RzKSA+PSAwO1xuICB9O1xuXG4gIGZ1bmN0aW9uIGlzT3V0RWZmZWN0IChlZmZlY3QpIHtcbiAgICByZXR1cm4gL091dC8udGVzdChlZmZlY3QpIHx8ICQuaW5BcnJheShlZmZlY3QsICQuZm4udGV4dGlsbGF0ZS5kZWZhdWx0cy5vdXRFZmZlY3RzKSA+PSAwO1xuICB9O1xuXG5cbiAgZnVuY3Rpb24gc3RyaW5nVG9Cb29sZWFuKHN0cikge1xuICAgIGlmIChzdHIgIT09IFwidHJ1ZVwiICYmIHN0ciAhPT0gXCJmYWxzZVwiKSByZXR1cm4gc3RyO1xuICAgIHJldHVybiAoc3RyID09PSBcInRydWVcIik7XG4gIH07XG5cbiAgLy8gY3VzdG9tIGdldCBkYXRhIGFwaSBtZXRob2RcbiAgZnVuY3Rpb24gZ2V0RGF0YSAobm9kZSkge1xuICAgIHZhciBhdHRycyA9IG5vZGUuYXR0cmlidXRlcyB8fCBbXVxuICAgICAgLCBkYXRhID0ge307XG5cbiAgICBpZiAoIWF0dHJzLmxlbmd0aCkgcmV0dXJuIGRhdGE7XG5cbiAgICAkLmVhY2goYXR0cnMsIGZ1bmN0aW9uIChpLCBhdHRyKSB7XG4gICAgICB2YXIgbm9kZU5hbWUgPSBhdHRyLm5vZGVOYW1lLnJlcGxhY2UoL2RlbGF5c2NhbGUvLCAnZGVsYXlTY2FsZScpO1xuICAgICAgaWYgKC9eZGF0YS1pbi0qLy50ZXN0KG5vZGVOYW1lKSkge1xuICAgICAgICBkYXRhLmluID0gZGF0YS5pbiB8fCB7fTtcbiAgICAgICAgZGF0YS5pbltub2RlTmFtZS5yZXBsYWNlKC9kYXRhLWluLS8sICcnKV0gPSBzdHJpbmdUb0Jvb2xlYW4oYXR0ci5ub2RlVmFsdWUpO1xuICAgICAgfSBlbHNlIGlmICgvXmRhdGEtb3V0LSovLnRlc3Qobm9kZU5hbWUpKSB7XG4gICAgICAgIGRhdGEub3V0ID0gZGF0YS5vdXQgfHwge307XG4gICAgICAgIGRhdGEub3V0W25vZGVOYW1lLnJlcGxhY2UoL2RhdGEtb3V0LS8sICcnKV0gPXN0cmluZ1RvQm9vbGVhbihhdHRyLm5vZGVWYWx1ZSk7XG4gICAgICB9IGVsc2UgaWYgKC9eZGF0YS0qLy50ZXN0KG5vZGVOYW1lKSkge1xuICAgICAgICBkYXRhW25vZGVOYW1lLnJlcGxhY2UoL2RhdGEtLywgJycpXSA9IHN0cmluZ1RvQm9vbGVhbihhdHRyLm5vZGVWYWx1ZSk7XG4gICAgICB9XG4gICAgfSlcblxuICAgIHJldHVybiBkYXRhO1xuICB9XG5cbiAgZnVuY3Rpb24gc2h1ZmZsZSAobykge1xuICAgICAgZm9yICh2YXIgaiwgeCwgaSA9IG8ubGVuZ3RoOyBpOyBqID0gcGFyc2VJbnQoTWF0aC5yYW5kb20oKSAqIGkpLCB4ID0gb1stLWldLCBvW2ldID0gb1tqXSwgb1tqXSA9IHgpO1xuICAgICAgcmV0dXJuIG87XG4gIH1cblxuICBmdW5jdGlvbiBhbmltYXRlICgkdCwgZWZmZWN0LCBjYikge1xuICAgICR0LmFkZENsYXNzKCdhbmltYXRlZCAnICsgZWZmZWN0KVxuICAgICAgLmNzcygndmlzaWJpbGl0eScsICd2aXNpYmxlJylcbiAgICAgIC5zaG93KCk7XG5cbiAgICAkdC5vbmUoJ3dlYmtpdEFuaW1hdGlvbkVuZCBtb3pBbmltYXRpb25FbmQgTVNBbmltYXRpb25FbmQgb2FuaW1hdGlvbmVuZCBhbmltYXRpb25lbmQnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICR0LnJlbW92ZUNsYXNzKCdhbmltYXRlZCAnICsgZWZmZWN0KTtcbiAgICAgICAgY2IgJiYgY2IoKTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGFuaW1hdGVUb2tlbnMgKCR0b2tlbnMsIG9wdGlvbnMsIGNiKSB7XG4gICAgdmFyIHRoYXQgPSB0aGlzXG4gICAgICAsIGNvdW50ID0gJHRva2Vucy5sZW5ndGg7XG5cbiAgICBpZiAoIWNvdW50KSB7XG4gICAgICBjYiAmJiBjYigpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChvcHRpb25zLnNodWZmbGUpICR0b2tlbnMgPSBzaHVmZmxlKCR0b2tlbnMpO1xuICAgIGlmIChvcHRpb25zLnJldmVyc2UpICR0b2tlbnMgPSAkdG9rZW5zLnRvQXJyYXkoKS5yZXZlcnNlKCk7XG5cbiAgICAkLmVhY2goJHRva2VucywgZnVuY3Rpb24gKGksIHQpIHtcbiAgICAgIHZhciAkdG9rZW4gPSAkKHQpO1xuXG4gICAgICBmdW5jdGlvbiBjb21wbGV0ZSAoKSB7XG4gICAgICAgIGlmIChpc0luRWZmZWN0KG9wdGlvbnMuZWZmZWN0KSkge1xuICAgICAgICAgICR0b2tlbi5jc3MoJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpO1xuICAgICAgICB9IGVsc2UgaWYgKGlzT3V0RWZmZWN0KG9wdGlvbnMuZWZmZWN0KSkge1xuICAgICAgICAgICR0b2tlbi5jc3MoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7XG4gICAgICAgIH1cbiAgICAgICAgY291bnQgLT0gMTtcbiAgICAgICAgaWYgKCFjb3VudCAmJiBjYikgY2IoKTtcbiAgICAgIH1cblxuICAgICAgdmFyIGRlbGF5ID0gb3B0aW9ucy5zeW5jID8gb3B0aW9ucy5kZWxheSA6IG9wdGlvbnMuZGVsYXkgKiBpICogb3B0aW9ucy5kZWxheVNjYWxlO1xuXG4gICAgICAkdG9rZW4udGV4dCgpID9cbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IGFuaW1hdGUoJHRva2VuLCBvcHRpb25zLmVmZmVjdCwgY29tcGxldGUpIH0sIGRlbGF5KSA6XG4gICAgICAgIGNvbXBsZXRlKCk7XG4gICAgfSk7XG4gIH07XG5cbiAgdmFyIFRleHRpbGxhdGUgPSBmdW5jdGlvbiAoZWxlbWVudCwgb3B0aW9ucykge1xuICAgIHZhciBiYXNlID0gdGhpc1xuICAgICAgLCAkZWxlbWVudCA9ICQoZWxlbWVudCk7XG5cbiAgICBiYXNlLmluaXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBiYXNlLiR0ZXh0cyA9ICRlbGVtZW50LmZpbmQob3B0aW9ucy5zZWxlY3Rvcik7XG5cbiAgICAgIGlmICghYmFzZS4kdGV4dHMubGVuZ3RoKSB7XG4gICAgICAgIGJhc2UuJHRleHRzID0gJCgnPHVsIGNsYXNzPVwidGV4dHNcIj48bGk+JyArICRlbGVtZW50Lmh0bWwoKSArICc8L2xpPjwvdWw+Jyk7XG4gICAgICAgICRlbGVtZW50Lmh0bWwoYmFzZS4kdGV4dHMpO1xuICAgICAgfVxuXG4gICAgICBiYXNlLiR0ZXh0cy5oaWRlKCk7XG5cbiAgICAgIGJhc2UuJGN1cnJlbnQgPSAkKCc8c3Bhbj4nKVxuICAgICAgICAuaHRtbChiYXNlLiR0ZXh0cy5maW5kKCc6Zmlyc3QtY2hpbGQnKS5odG1sKCkpXG4gICAgICAgIC5wcmVwZW5kVG8oJGVsZW1lbnQpO1xuXG4gICAgICBpZiAoaXNJbkVmZmVjdChvcHRpb25zLmluLmVmZmVjdCkpIHtcbiAgICAgICAgYmFzZS4kY3VycmVudC5jc3MoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7XG4gICAgICB9IGVsc2UgaWYgKGlzT3V0RWZmZWN0KG9wdGlvbnMub3V0LmVmZmVjdCkpIHtcbiAgICAgICAgYmFzZS4kY3VycmVudC5jc3MoJ3Zpc2liaWxpdHknLCAndmlzaWJsZScpO1xuICAgICAgfVxuXG4gICAgICBiYXNlLnNldE9wdGlvbnMob3B0aW9ucyk7XG5cbiAgICAgIGJhc2UudGltZW91dFJ1biA9IG51bGw7XG5cbiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICBiYXNlLm9wdGlvbnMuYXV0b1N0YXJ0ICYmIGJhc2Uuc3RhcnQoKTtcbiAgICAgIH0sIGJhc2Uub3B0aW9ucy5pbml0aWFsRGVsYXkpXG4gICAgfTtcblxuICAgIGJhc2Uuc2V0T3B0aW9ucyA9IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICBiYXNlLm9wdGlvbnMgPSBvcHRpb25zO1xuICAgIH07XG5cbiAgICBiYXNlLnRyaWdnZXJFdmVudCA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgICB2YXIgZSA9ICQuRXZlbnQobmFtZSArICcudGx0Jyk7XG4gICAgICAkZWxlbWVudC50cmlnZ2VyKGUsIGJhc2UpO1xuICAgICAgcmV0dXJuIGU7XG4gICAgfTtcblxuICAgIGJhc2UuaW4gPSBmdW5jdGlvbiAoaW5kZXgsIGNiKSB7XG4gICAgICBpbmRleCA9IGluZGV4IHx8IDA7XG5cbiAgICAgIHZhciAkZWxlbSA9IGJhc2UuJHRleHRzLmZpbmQoJzpudGgtY2hpbGQoJyArICgoaW5kZXh8fDApICsgMSkgKyAnKScpXG4gICAgICAgICwgb3B0aW9ucyA9ICQuZXh0ZW5kKHRydWUsIHt9LCBiYXNlLm9wdGlvbnMsICRlbGVtLmxlbmd0aCA/IGdldERhdGEoJGVsZW1bMF0pIDoge30pXG4gICAgICAgICwgJHRva2VucztcblxuICAgICAgJGVsZW0uYWRkQ2xhc3MoJ2N1cnJlbnQnKTtcblxuICAgICAgYmFzZS50cmlnZ2VyRXZlbnQoJ2luQW5pbWF0aW9uQmVnaW4nKTtcblxuICAgICAgYmFzZS4kY3VycmVudFxuICAgICAgICAuaHRtbCgkZWxlbS5odG1sKCkpXG4gICAgICAgIC5sZXR0ZXJpbmcoJ3dvcmRzJyk7XG5cbiAgICAgIC8vIHNwbGl0IHdvcmRzIHRvIGluZGl2aWR1YWwgY2hhcmFjdGVycyBpZiB0b2tlbiB0eXBlIGlzIHNldCB0byAnY2hhcidcbiAgICAgIGlmIChiYXNlLm9wdGlvbnMudHlwZSA9PSBcImNoYXJcIikge1xuICAgICAgICBiYXNlLiRjdXJyZW50LmZpbmQoJ1tjbGFzc149XCJ3b3JkXCJdJylcbiAgICAgICAgICAgIC5jc3Moe1xuICAgICAgICAgICAgICAnZGlzcGxheSc6ICdpbmxpbmUtYmxvY2snLFxuICAgICAgICAgICAgICAvLyBmaXggZm9yIHBvb3IgaW9zIHBlcmZvcm1hbmNlXG4gICAgICAgICAgICAgICctd2Via2l0LXRyYW5zZm9ybSc6ICd0cmFuc2xhdGUzZCgwLDAsMCknLFxuICAgICAgICAgICAgICAnLW1vei10cmFuc2Zvcm0nOiAndHJhbnNsYXRlM2QoMCwwLDApJyxcbiAgICAgICAgICAgICAgJy1vLXRyYW5zZm9ybSc6ICd0cmFuc2xhdGUzZCgwLDAsMCknLFxuICAgICAgICAgICAgICAndHJhbnNmb3JtJzogJ3RyYW5zbGF0ZTNkKDAsMCwwKSdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuZWFjaChmdW5jdGlvbiAoKSB7ICQodGhpcykubGV0dGVyaW5nKCkgfSk7XG4gICAgICB9XG5cbiAgICAgICR0b2tlbnMgPSBiYXNlLiRjdXJyZW50XG4gICAgICAgIC5maW5kKCdbY2xhc3NePVwiJyArIGJhc2Uub3B0aW9ucy50eXBlICsgJ1wiXScpXG4gICAgICAgIC5jc3MoJ2Rpc3BsYXknLCAnaW5saW5lLWJsb2NrJyk7XG5cbiAgICAgIGlmIChpc0luRWZmZWN0KG9wdGlvbnMuaW4uZWZmZWN0KSkge1xuICAgICAgICAkdG9rZW5zLmNzcygndmlzaWJpbGl0eScsICdoaWRkZW4nKTtcbiAgICAgIH0gZWxzZSBpZiAoaXNPdXRFZmZlY3Qob3B0aW9ucy5pbi5lZmZlY3QpKSB7XG4gICAgICAgICR0b2tlbnMuY3NzKCd2aXNpYmlsaXR5JywgJ3Zpc2libGUnKTtcbiAgICAgIH1cblxuICAgICAgYmFzZS5jdXJyZW50SW5kZXggPSBpbmRleDtcblxuICAgICAgYW5pbWF0ZVRva2VucygkdG9rZW5zLCBvcHRpb25zLmluLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGJhc2UudHJpZ2dlckV2ZW50KCdpbkFuaW1hdGlvbkVuZCcpO1xuICAgICAgICBpZiAob3B0aW9ucy5pbi5jYWxsYmFjaykgb3B0aW9ucy5pbi5jYWxsYmFjaygpO1xuICAgICAgICBpZiAoY2IpIGNiKGJhc2UpO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIGJhc2Uub3V0ID0gZnVuY3Rpb24gKGNiKSB7XG4gICAgICB2YXIgJGVsZW0gPSBiYXNlLiR0ZXh0cy5maW5kKCc6bnRoLWNoaWxkKCcgKyAoKGJhc2UuY3VycmVudEluZGV4fHwwKSArIDEpICsgJyknKVxuICAgICAgICAsICR0b2tlbnMgPSBiYXNlLiRjdXJyZW50LmZpbmQoJ1tjbGFzc149XCInICsgYmFzZS5vcHRpb25zLnR5cGUgKyAnXCJdJylcbiAgICAgICAgLCBvcHRpb25zID0gJC5leHRlbmQodHJ1ZSwge30sIGJhc2Uub3B0aW9ucywgJGVsZW0ubGVuZ3RoID8gZ2V0RGF0YSgkZWxlbVswXSkgOiB7fSlcblxuICAgICAgYmFzZS50cmlnZ2VyRXZlbnQoJ291dEFuaW1hdGlvbkJlZ2luJyk7XG5cbiAgICAgIGFuaW1hdGVUb2tlbnMoJHRva2Vucywgb3B0aW9ucy5vdXQsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJGVsZW0ucmVtb3ZlQ2xhc3MoJ2N1cnJlbnQnKTtcbiAgICAgICAgYmFzZS50cmlnZ2VyRXZlbnQoJ291dEFuaW1hdGlvbkVuZCcpO1xuICAgICAgICBpZiAob3B0aW9ucy5vdXQuY2FsbGJhY2spIG9wdGlvbnMub3V0LmNhbGxiYWNrKCk7XG4gICAgICAgIGlmIChjYikgY2IoYmFzZSk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgYmFzZS5zdGFydCA9IGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgIGJhc2UudHJpZ2dlckV2ZW50KCdzdGFydCcpO1xuXG4gICAgICAoZnVuY3Rpb24gcnVuIChpbmRleCkge1xuICAgICAgICBiYXNlLmluKGluZGV4LCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdmFyIGxlbmd0aCA9IGJhc2UuJHRleHRzLmNoaWxkcmVuKCkubGVuZ3RoO1xuXG4gICAgICAgICAgaW5kZXggKz0gMTtcblxuICAgICAgICAgIGlmICghYmFzZS5vcHRpb25zLmxvb3AgJiYgaW5kZXggPj0gbGVuZ3RoKSB7XG4gICAgICAgICAgICBpZiAoYmFzZS5vcHRpb25zLmNhbGxiYWNrKSBiYXNlLm9wdGlvbnMuY2FsbGJhY2soKTtcbiAgICAgICAgICAgIGJhc2UudHJpZ2dlckV2ZW50KCdlbmQnKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaW5kZXggPSBpbmRleCAlIGxlbmd0aDtcblxuICAgICAgICAgICAgYmFzZS50aW1lb3V0UnVuID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIGJhc2Uub3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBydW4oaW5kZXgpXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSwgYmFzZS5vcHRpb25zLm1pbkRpc3BsYXlUaW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfShpbmRleCB8fCAwKSk7XG4gICAgICB9LCBiYXNlLm9wdGlvbnMuaW5pdGlhbERlbGF5KTtcbiAgICB9O1xuXG4gICAgYmFzZS5zdG9wID0gZnVuY3Rpb24gKCkge1xuICAgICAgaWYgKGJhc2UudGltZW91dFJ1bikge1xuICAgICAgICBjbGVhckludGVydmFsKGJhc2UudGltZW91dFJ1bik7XG4gICAgICAgIGJhc2UudGltZW91dFJ1biA9IG51bGw7XG4gICAgICB9XG4gICAgfTtcblxuICAgIGJhc2UuaW5pdCgpO1xuICB9XG5cbiAgJC5mbi50ZXh0aWxsYXRlID0gZnVuY3Rpb24gKHNldHRpbmdzLCBhcmdzKSB7XG4gICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpXG4gICAgICAgICwgZGF0YSA9ICR0aGlzLmRhdGEoJ3RleHRpbGxhdGUnKVxuICAgICAgICAsIG9wdGlvbnMgPSAkLmV4dGVuZCh0cnVlLCB7fSwgJC5mbi50ZXh0aWxsYXRlLmRlZmF1bHRzLCBnZXREYXRhKHRoaXMpLCB0eXBlb2Ygc2V0dGluZ3MgPT0gJ29iamVjdCcgJiYgc2V0dGluZ3MpO1xuXG4gICAgICBpZiAoIWRhdGEpIHtcbiAgICAgICAgJHRoaXMuZGF0YSgndGV4dGlsbGF0ZScsIChkYXRhID0gbmV3IFRleHRpbGxhdGUodGhpcywgb3B0aW9ucykpKTtcbiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHNldHRpbmdzID09ICdzdHJpbmcnKSB7XG4gICAgICAgIGRhdGFbc2V0dGluZ3NdLmFwcGx5KGRhdGEsIFtdLmNvbmNhdChhcmdzKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkYXRhLnNldE9wdGlvbnMuY2FsbChkYXRhLCBvcHRpb25zKTtcbiAgICAgIH1cbiAgICB9KVxuICB9O1xuXG4gICQuZm4udGV4dGlsbGF0ZS5kZWZhdWx0cyA9IHtcbiAgICBzZWxlY3RvcjogJy50ZXh0cycsXG4gICAgbG9vcDogZmFsc2UsXG4gICAgbWluRGlzcGxheVRpbWU6IDIwMDAsXG4gICAgaW5pdGlhbERlbGF5OiAwLFxuICAgIGluOiB7XG4gICAgICBlZmZlY3Q6ICdmYWRlSW5MZWZ0QmlnJyxcbiAgICAgIGRlbGF5U2NhbGU6IDEuNSxcbiAgICAgIGRlbGF5OiA1MCxcbiAgICAgIHN5bmM6IGZhbHNlLFxuICAgICAgcmV2ZXJzZTogZmFsc2UsXG4gICAgICBzaHVmZmxlOiBmYWxzZSxcbiAgICAgIGNhbGxiYWNrOiBmdW5jdGlvbiAoKSB7fVxuICAgIH0sXG4gICAgb3V0OiB7XG4gICAgICBlZmZlY3Q6ICdoaW5nZScsXG4gICAgICBkZWxheVNjYWxlOiAxLjUsXG4gICAgICBkZWxheTogNTAsXG4gICAgICBzeW5jOiBmYWxzZSxcbiAgICAgIHJldmVyc2U6IGZhbHNlLFxuICAgICAgc2h1ZmZsZTogZmFsc2UsXG4gICAgICBjYWxsYmFjazogZnVuY3Rpb24gKCkge31cbiAgICB9LFxuICAgIGF1dG9TdGFydDogdHJ1ZSxcbiAgICBpbkVmZmVjdHM6IFtdLFxuICAgIG91dEVmZmVjdHM6IFsgJ2hpbmdlJyBdLFxuICAgIGNhbGxiYWNrOiBmdW5jdGlvbiAoKSB7fSxcbiAgICB0eXBlOiAnY2hhcidcbiAgfTtcblxufShqUXVlcnkpKTsiXX0=